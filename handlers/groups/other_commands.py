from aiogram import types
from aiogram.dispatcher.filters import Command, CommandStart
from aiogram.utils.exceptions import CantParseEntities

from filters import IsGroup
from loader import dp, db
from utils.throttlig import rate_limit


@rate_limit(limit=3)
@dp.message_handler(IsGroup(), Command('help'))
async def command_help(message: types.Message):
    text = f'‚ùî<b>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º</b>‚ùî\n\n' \
           f'–í—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ, –Ω–∞–ø–∏—à–∏ –±–æ—Ç—É –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –∏ –±–æ—Ç –≤—ã–¥–∞—Å—Ç —Ç–µ–±–µ –≤—Å–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∫–Ω–∏–≥–∏\n' \
           f'–õ–∏–±–æ —Ç—ã –º–æ–∂–µ—à—å –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º –ø–æ–∏—Å–∫–æ–º, —Å –ø–æ–º–æ—â—å—é —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–º–∞–Ω–¥: üëá\n\n' \
           f'/start - —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞, —á—Ç–æ–±—ã –≤–ø–µ—Ä–≤—ã–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n' \
           f'/author <i>–∏–º—è –∞–≤—Ç–æ—Ä–∞</i> - –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∞–≤—Ç–æ—Ä–∞–º\n' \
           f'/series <i>–Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–∏–∏</i> - –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Å–µ—Ä–∏–∏\n' \
           f'/rating_b - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¢–û–ü 10 –∫–Ω–∏–≥ –ø–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è–º\n' \
           f'/rating_a - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¢–û–ü 10 –∞–≤—Ç–æ—Ä–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º\n' \
           f'/help - –≤—ã–∑–æ–≤ —Å–ø—Ä–∞–≤–∫–∏, –µ—Å–ª–∏ —Ç—ã –∑–∞–±—ã–ª –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–ºüôÉ\n' \
           f'/report - –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–ø–∞–º/—Ä–µ–∫–ª–∞–º—É/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n\n' \
           f'‚ùó–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n' \
           f'- –ó–∞–∂–∞—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n' \
           f'—á—Ç–æ–±—ã —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—ã–¥–µ–ª–∏–ª–æ—Å—å, –Ω–∞–∂–∞—Ç—å <b>"–û—Ç–≤–µ—Ç–∏—Ç—å"</b> –∏ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /report\n\n' \
           f'‚ùî <b>–ö–∞–∫ –∏—Å–∫–∞—Ç—å –∫–Ω–∏–≥–∏</b> ‚ùî\n\n' \
           f'–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—É—é –∫–Ω–∏–≥—É, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –µ—ë –Ω–∞–∑–≤–∞–Ω–∏–µ\n' \
           f'–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ! –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –±–µ–∑ –§–ò–û –∞–≤—Ç–æ—Ä–∞\n' \
           f'–¢–∞–∫–∂–µ —Ç—ã –º–æ–∂–µ—à—å –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ—á–Ω—ã–º –ø–æ–∏—Å–∫–æ–º üëá\n\n' \
           f'–ü—Ä–∏–º–µ—Ä—ã —Ç–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:\n' \
           f'/author –î–∂–æ–∞–Ω –†–æ—É–ª–∏–Ω–≥\n' \
           f'/author –ü—É—à–∫–∏–Ω\n' \
           f'/series –ø–µ—Å–Ω—å –ª—å–¥–∞ –∏ –ø–ª–∞–º–µ–Ω–∏\n' \
           f'/series –ì–æ–ª–æ–¥–Ω—ã–µ –ò–≥—Ä—ã\n\n' \
           f'‚ùó–ï—Å–ª–∏ –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –æ—à–∏–±–∫—É –≤ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞,\n' \
           f'‚ùó–õ–∏–±–æ —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –±–æ—Ç–∞\n' \
           f'–ù–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º üëá\n' \
           f'<pre>!message <i>–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É</i></pre>\n\n' \
           f'<b>P.S.</b>\n' \
           f'–ö–Ω–∏–∂–Ω—ã–π –±–∞—Ä: @books_bar üìö\n' \
           f'–ö–Ω–∏–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è\n' \
           f'–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ª–∏—á–Ω–æ–π –≥—Ä—É–ø–ø—ã: /create_group'
    await message.answer(text)


@rate_limit(limit=3)
@dp.message_handler(IsGroup(), CommandStart())
async def command_start(message: types.Message):
    text = f'–ü—Ä–∏–≤–µ—Ç, {message.from_user.full_name}! \n\n–Ø –ø–æ–º–æ–≥—É –Ω–∞–π—Ç–∏ —Ç–µ–±–µ –ª—é–±—É—é –∫–Ω–∏–≥—É!üòá\n' \
           f'–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –ø—Ä–∏—à–ª–∏ –º–Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ üìñ\n\n' \
           f'–Ø —Ç–∞–∫–∂–µ –º–æ–≥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ –§–ò–û –∞–≤—Ç–æ—Ä–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é –∫–Ω–∏–∂–Ω–æ–π —Å–µ—Ä–∏–∏ ‚ò∫\n' \
           f'–¢—ã –º–æ–∂–µ—à—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ–±–æ –º–Ω–µ –∑–¥–µ—Å—å üëâ /help\n' \
           f'@books_bar - –∫–Ω–∏–∂–Ω—ã–π –±–∞—Ä üìö'

    try:
        await message.answer(text)
    except CantParseEntities:  # –û—à–∏–±–∫–∞, –µ—Å–ª–∏ —É —é–∑–µ—Ä–∞ –Ω–∏–∫–Ω–µ–π–º –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä–Ω—ã–π
        pass
    await db.add_user(user=message.from_user.full_name, telegram_id=message.from_user.id)
